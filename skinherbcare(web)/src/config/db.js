import mongoose from 'mongoose';

const connectDB = async () => {
  try {
    // ‡∏õ‡∏¥‡∏î Warning ‡∏Ç‡∏≠‡∏á Mongoose
    mongoose.set('strictQuery', false);

    // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Ñ‡πà‡∏≤ URI ‡πÉ‡∏ô .env ‡πÑ‡∏´‡∏°
    if (!process.env.MONGODB_URI) {
      throw new Error('MONGODB_URI ‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå .env ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö!');
    }

    console.log('üîç Connecting to MongoDB...');

    // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
    const conn = await mongoose.connect(process.env.MONGODB_URI);

    // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏à‡∏∞‡∏Ç‡∏∂‡πâ‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡∏µ‡πâ
    console.log(`‚úÖ MongoDB Connected: ${conn.connection.host}`);

  } catch (error) {
    console.error(`‚ùå MongoDB Connection Error: ${error.message}`);
    // ‡∏•‡∏ö process.exit(1) ‡∏≠‡∏≠‡∏Å ‡∏´‡∏£‡∏∑‡∏≠ comment ‡πÑ‡∏ß‡πâ
    // process.exit(1); 

    // ‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏° logic ‡πÉ‡∏´‡πâ retry connection ‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï
    console.log("‚ö†Ô∏è Retrying connection in 5 seconds...");
    setTimeout(connectDB, 5000);
  }
};

// **‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î** ‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏´‡πâ server.js ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ
export default connectDB;